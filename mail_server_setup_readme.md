# 个人邮件服务器一键部署脚本

这个项目包含两个脚本，用于在Debian/Ubuntu服务器上快速部署个人邮件服务器。支持Windows和Linux系统运行部署脚本。

## 前提条件

1. 一个运行Debian/Ubuntu的服务器（推荐Ubuntu 20.04或更新版本）
2. 一个已注册的域名
3. 能够修改域名DNS记录的权限
4. 服务器的25、80、443、587、993和995端口必须开放

## 使用方法

### Windows用户

1. 确保您的系统已安装PowerShell（Windows 10和11默认已安装）
2. 下载`setup_mail_server_windows.ps1`脚本
3. 打开PowerShell，切换到脚本所在目录
4. 运行脚本：
   ```powershell
   .\setup_mail_server_windows.ps1
   ```
5. 根据提示输入以下信息：
   - 服务器IP地址
   - SSH用户名
   - SSH密码
   - 域名

### Linux用户

1. 下载`setup_mail_server_linux.sh`脚本
2. 给脚本添加执行权限：
   ```bash
   chmod +x setup_mail_server_linux.sh
   ```
3. 以root权限运行脚本：
   ```bash
   sudo ./setup_mail_server_linux.sh
   ```
4. 根据提示输入以下信息：
   - 服务器IP地址
   - SSH用户名
   - SSH密码
   - 域名

## 脚本功能

脚本会自动完成以下配置：

1. 更新系统包
2. 设置正确的主机名
3. 安装和配置必要的软件包：
   - Postfix（邮件传输服务器）
   - Dovecot（邮件接收服务器）
   - Nginx（网页服务器）
   - Certbot（SSL证书管理工具）
   - SpamAssassin（垃圾邮件过滤器）
   - OpenDKIM（邮件认证系统）

4. 配置邮件服务器端口：
   - SMTP: 25（标准邮件传输端口）
   - SMTPS: 465（加密邮件传输端口）
   - Submission: 587（邮件客户端提交端口）
   - IMAP: 143（标准邮件收取端口）
   - IMAPS: 993（加密邮件收取端口）
   - POP3: 110（标准邮件下载端口）
   - POP3S: 995（加密邮件下载端口）

5. 自动配置防火墙规则
6. 配置SSL安全证书
7. 设置DKIM邮件认证
8. 配置垃圾邮件过滤系统

## 安装后配置

安装完成后，需要进行以下操作：

1. 配置域名DNS记录：
   - 添加MX记录（指定邮件服务器地址）
   - 添加SPF记录（防止邮件伪造）
   - 添加DKIM记录（数字签名认证）
   - 添加DMARC记录（邮件认证报告和符合度）

2. 测试邮件服务器功能：
   - 使用邮件客户端（如Outlook）测试发送和接收
   - 检查SSL加密连接是否正常
   - 验证垃圾邮件过滤是否生效

3. 定期维护工作：
   - 更新SSL证书（建议每3个月检查一次）
   - 检查服务器日志（建议每周检查）
   - 监控垃圾邮件过滤效果（建议每周检查）

## 邮件客户端设置

配置邮件客户端时使用以下参数：

### 发送邮件（SMTP）设置：
- 服务器地址：mail.你的域名.com
- 端口选择：587（推荐）或465
- 加密方式：STARTTLS（587端口）或SSL/TLS（465端口）
- 身份验证：需要账号密码

### 接收邮件设置：
- IMAP服务器：mail.你的域名.com
- IMAP端口：993
- 加密方式：SSL/TLS
- POP3服务器：mail.你的域名.com（如果使用POP3）
- POP3端口：995
- 加密方式：SSL/TLS

## 安全建议

1. 安装完成后必须立即修改默认密码
2. 定期更新系统和相关软件包
3. 经常检查服务器日志，及时发现异常活动
4. 确保防火墙规则正确设置
5. 定期备份邮件数据
6. 建议每月进行一次完整的安全检查

## 默认配置

- 管理员账户：
  - 用户名：admin
  - 默认密码：admin123（请务必修改）

- 邮件服务访问地址：
  - IMAP：mail.你的域名.com:993（SSL/TLS加密）
  - SMTP：mail.你的域名.com:587（STARTTLS加密）
  - POP3：mail.你的域名.com:995（SSL/TLS加密）

## 常见问题排查

如果遇到问题，请检查：

1. 确认所有必需的端口是否已开放
2. 检查DNS记录是否正确配置
3. 验证SSL证书是否正常
4. 查看服务器错误日志
5. 确认防火墙规则是否正确
6. 检查邮件服务进程是否正常运行

## 技术支持

如遇到无法解决的问题，请：

1. 收集相关的错误日志
2. 准备服务器基本信息（系统版本、配置等）
3. 详细描述问题发生的步骤
4. 通过Issues提交问题

## 许可证

MIT License
